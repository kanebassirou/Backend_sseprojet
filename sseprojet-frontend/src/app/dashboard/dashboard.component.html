<!-- Dashboard Header -->
<div class="dashboard-header">
  <h1>Tableau de Bord</h1>
  <p *ngIf="currentUser" class="welcome-message">
    Bienvenue, {{ currentUser.nom }} 
    <span class="user-badge">{{ getUserRoleLabel(userType!) }}</span>
  </p>
</div>

<!-- Loading State -->
<div *ngIf="loading" class="loading-container">
  <mat-spinner></mat-spinner>
  <p>Chargement des données...</p>
</div>

<!-- Error State -->
<div *ngIf="error && !loading" class="error-container">
  <mat-icon>error</mat-icon>
  <p>{{ error }}</p>
  <button mat-button (click)="loadDashboardData()">Réessayer</button>
</div>

<!-- Dashboard Content -->
<div *ngIf="!loading && !error" class="dashboard-content">

  <!-- Statistics Cards - Common to all users -->
  <div class="stats-grid">
    <mat-card class="stat-card projets" *ngIf="canViewProjets()">
      <mat-card-header>
        <mat-icon mat-card-avatar>folder</mat-icon>
        <mat-card-title>{{ getProjetTitle() }}</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="stat-number">{{ stats.totalProjets }}</div>
        <div class="stat-subtitle">{{ stats.projetsEnCours }} en cours</div>
      </mat-card-content>
      <mat-card-actions>
        <button mat-button [routerLink]="['/projets']">Voir tout</button>
      </mat-card-actions>
    </mat-card>

    <mat-card class="stat-card taches" *ngIf="canViewTaches()">
      <mat-card-header>
        <mat-icon mat-card-avatar>task</mat-icon>
        <mat-card-title>Tâches</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="stat-number">{{ stats.totalTaches }}</div>
        <div class="stat-subtitle">{{ stats.tachesEnRetard }} en retard</div>
      </mat-card-content>
      <mat-card-actions>
        <button mat-button [routerLink]="['/taches']">Voir tout</button>
      </mat-card-actions>
    </mat-card>

    <mat-card class="stat-card rapports">
      <mat-card-header>
        <mat-icon mat-card-avatar>description</mat-icon>
        <mat-card-title>Rapports</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="stat-number">{{ stats.totalRapports }}</div>
        <div class="stat-subtitle">Disponibles</div>
      </mat-card-content>
      <mat-card-actions>
        <button mat-button [routerLink]="['/rapports']">Voir tout</button>
      </mat-card-actions>
    </mat-card>

    <!-- Admin specific cards -->
    <mat-card class="stat-card users" *ngIf="userType === 'ADMINISTRATEUR'">
      <mat-card-header>
        <mat-icon mat-card-avatar>people</mat-icon>
        <mat-card-title>Utilisateurs</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="stat-number">{{ adminStats.totalUtilisateurs }}</div>
        <div class="stat-subtitle">{{ adminStats.nouveauxUtilisateurs }} nouveaux</div>
      </mat-card-content>
      <mat-card-actions>
        <button mat-button [routerLink]="['/users']">Gérer</button>
      </mat-card-actions>
    </mat-card>

    <!-- Chef de Projet specific cards -->
    <mat-card class="stat-card assigned" *ngIf="userType === 'CHEF_DE_PROJET'">
      <mat-card-header>
        <mat-icon mat-card-avatar>assignment</mat-icon>
        <mat-card-title>Mes Projets</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="stat-number">{{ chefStats.projetsAssignes }}</div>
        <div class="stat-subtitle">{{ chefStats.tachesAFaire }} tâches à faire</div>
      </mat-card-content>
      <mat-card-actions>
        <button mat-button [routerLink]="['/projets']">Voir mes projets</button>
      </mat-card-actions>
    </mat-card>

    <!-- Evaluateur specific cards -->
    <mat-card class="stat-card evaluations" *ngIf="userType === 'EVALUATEUR'">
      <mat-card-header>
        <mat-icon mat-card-avatar>assessment</mat-icon>
        <mat-card-title>Évaluations</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="stat-number">{{ evaluateurStats.evaluationsEnAttente }}</div>
        <div class="stat-subtitle">En attente</div>
      </mat-card-content>
      <mat-card-actions>
        <button mat-button [routerLink]="['/evaluations']">Évaluer</button>
      </mat-card-actions>
    </mat-card>
  </div>

  <!-- Quick Actions Section -->
  <div class="quick-actions-section">
    <h2>Actions Rapides</h2>
    <div class="actions-grid">
      
      <!-- Admin Actions -->
      <div *ngIf="userType === 'ADMINISTRATEUR'" class="action-group">
        <button mat-raised-button color="primary" [routerLink]="['/users/create']">
          <mat-icon>person_add</mat-icon>
          Créer Utilisateur
        </button>
        <button mat-raised-button color="accent" [routerLink]="['/projets/create']">
          <mat-icon>add</mat-icon>
          Nouveau Projet
        </button>
        <button mat-stroked-button [routerLink]="['/rapports']">
          <mat-icon>analytics</mat-icon>
          Voir Rapports
        </button>
      </div>

      <!-- Chef de Projet Actions -->
      <div *ngIf="userType === 'CHEF_DE_PROJET'" class="action-group">
        <button mat-raised-button color="primary" [routerLink]="['/taches/create']">
          <mat-icon>add_task</mat-icon>
          Nouvelle Tâche
        </button>
        <button mat-raised-button color="accent" [routerLink]="['/rapports/create']">
          <mat-icon>note_add</mat-icon>
          Créer Rapport
        </button>
        <button mat-stroked-button [routerLink]="['/projets']">
          <mat-icon>folder</mat-icon>
          Mes Projets
        </button>
      </div>

      <!-- Décideur Actions -->
      <div *ngIf="userType === 'DECIDEUR'" class="action-group">
        <button mat-raised-button color="primary" [routerLink]="['/projets']">
          <mat-icon>search</mat-icon>
          Consulter Projets
        </button>
        <button mat-raised-button color="accent" [routerLink]="['/rapports']">
          <mat-icon>description</mat-icon>
          Voir Rapports
        </button>
        <button mat-stroked-button [routerLink]="['/indicateurs']">
          <mat-icon>trending_up</mat-icon>
          Indicateurs
        </button>
      </div>

      <!-- Évaluateur Actions -->
      <div *ngIf="userType === 'EVALUATEUR'" class="action-group">
        <button mat-raised-button color="primary" [routerLink]="['/evaluations']">
          <mat-icon>rate_review</mat-icon>
          Évaluer Projet
        </button>
        <button mat-raised-button color="accent" [routerLink]="['/rapports']">
          <mat-icon>description</mat-icon>
          Consulter Rapports
        </button>
        <button mat-stroked-button [routerLink]="['/indicateurs']">
          <mat-icon>analytics</mat-icon>
          Voir Indicateurs
        </button>
      </div>
    </div>
  </div>

  <!-- Recent Activity Section -->
  <div class="recent-activity-section">
    <h2>Activité Récente</h2>
    <mat-card class="activity-card">
      <mat-card-content>
        <p class="no-activity">Aucune activité récente disponible pour le moment.</p>
        <!-- TODO: Implémenter la liste des activités récentes -->
      </mat-card-content>
    </mat-card>
  </div>

</div>
